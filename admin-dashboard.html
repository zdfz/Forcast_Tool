<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Admin Dashboard</title>
		<link rel="icon" type="image/png" href="favicon.png">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
		<link rel="stylesheet" href="assets/css/styles.css">
		<style>
			/* Resizable table columns */
			#submissionsTable {
				table-layout: fixed;
			}
			
			#submissionsTable th {
				position: relative;
				min-width: 80px;
				border-right: 2px solid #dee2e6;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				user-select: none;
			}
			
			/* Sticky header */
			#submissionsTable thead th {
				position: sticky;
				top: 0;
				background-color: #f8f9fa;
				z-index: 10;
				box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1);
			}
			
			/* Column resize handle */
			.resize-handle {
				position: absolute;
				right: -4px;
				top: 0;
				height: 100%;
				width: 8px;
				cursor: col-resize;
				background: rgba(0, 0, 0, 0.1);
				z-index: 11;
				border-radius: 2px;
			}
			
			.resize-handle:hover {
				background: rgba(0, 123, 255, 0.5);
				width: 10px;
				right: -5px;
			}
			
			/* Improved cell styling */
			#submissionsTable td {
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				padding: 8px 12px;
			}
			
			/* Specific column widths */
			#submissionsTable th:nth-child(1) { width: 150px; } /* Forecast Logged Date */
			#submissionsTable th:nth-child(2) { width: 180px; } /* Week Calendar */
			#submissionsTable th:nth-child(3) { width: 120px; } /* Company */
			#submissionsTable th:nth-child(4) { width: 120px; } /* Service Type */
			#submissionsTable th:nth-child(5) { width: 120px; } /* Weekly Ship */
			#submissionsTable th:nth-child(6) { width: 180px; } /* Fulfilment Outbound (Units) */
			#submissionsTable th:nth-child(7) { width: 180px; } /* Fulfilment Inbound (Units) */
			#submissionsTable th:nth-child(8) { width: 120px; } /* Inbound Freq */
			#submissionsTable th:nth-child(9) { width: 140px; } /* Avg Units/Ship */
			#submissionsTable th:nth-child(10) { width: 100px; } /* COD % */
			#submissionsTable th:nth-child(11) { width: 100px; } /* PPD % */
			#submissionsTable th:nth-child(12) { width: 120px; } /* Service Mix */
			#submissionsTable th:nth-child(13) { width: 150px; } /* Forecast Period */
			#submissionsTable th:nth-child(14) { width: 200px; } /* SKU Notes */
			#submissionsTable th:nth-child(15) { width: 200px; } /* Bundles */
			#submissionsTable th:nth-child(16) { width: 160px; } /* Actions */
			
			/* Scrollbar styling */
			.table-responsive::-webkit-scrollbar {
				height: 8px;
				width: 8px;
			}
			
			.table-responsive::-webkit-scrollbar-track {
				background: #f1f1f1;
				border-radius: 4px;
			}
			
			.table-responsive::-webkit-scrollbar-thumb {
				background: #888;
				border-radius: 4px;
			}
			
			.table-responsive::-webkit-scrollbar-thumb:hover {
				background: #555;
			}

			/* Modal styling */
			.modal-xl {
				max-width: 90%;
			}

			.modal-body {
				max-height: 70vh;
				overflow-y: auto;
			}

			/* Form validation styling */
			.is-invalid {
				border-color: #dc3545;
			}

			.invalid-feedback {
				display: block;
				color: #dc3545;
				font-size: 0.875em;
			}
		</style>
	</head>
	<body>
		<div id="navbar-container"></div>
		<main class="container py-3">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h1 class="h4 page-header" id="dashboardTitle">Global Forecast Dashboard</h1>
				<div class="d-flex gap-2">
					<select id="customerFilter" class="form-select" style="min-width:260px;"></select>
					<button class="btn btn-outline-primary" id="downloadPdfBtn">Download PDF</button>
				</div>
			</div>

			<div id="dashboard-container">
				<ul class="nav nav-tabs" id="dashTabs" role="tablist">
					<li class="nav-item" role="presentation">
						<button class="nav-link active" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts" type="button" role="tab">Charts</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">Data</button>
					</li>
				</ul>
				<div class="tab-content" id="dashTabsContent">
					<div class="tab-pane fade show active" id="charts" role="tabpanel">
						<div class="row g-3">
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Total Expected Monthly Shipments</h6><canvas id="chartShipments"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Total Expected Monthly Invoice Value</h6><canvas id="chartInvoice"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Average Service Mix</h6><canvas id="chartService"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Average COD/PPD Split</h6><canvas id="chartCod"></canvas></div></div>
							</div>
						</div>
					</div>
					<div class="tab-pane fade" id="data" role="tabpanel">
						<div class="table-responsive" style="max-height: 70vh; overflow-x: auto; overflow-y: auto;">
							<table class="table table-sm align-middle table-striped" id="submissionsTable" style="min-width: 1640px;">
								<thead>
									<tr>
										<th>Forecast Logged Date</th>
										<th>Week Calendar</th>
										<th>Company</th>
										<th>Service Type</th>
										<th>Weekly Ship</th>
										<th>Fulfilment Outbound (Units)</th>
										<th>Fulfilment Inbound (Units)</th>
										<th>Inbound Freq</th>
										<th>Avg Units/Ship</th>
										<th>COD %</th>
										<th>PPD %</th>
										<th>Service Mix</th>
										<th>Forecast Period</th>
										<th>SKU Notes</th>
										<th>Bundles</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</main>

		<!-- Edit Customer Modal -->
		<div class="modal fade" id="editCustomerModal" tabindex="-1" aria-labelledby="editCustomerModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="editCustomerModalLabel">Edit Customer Forecast</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form id="editCustomerForm">
							<div class="row g-3">
								<!-- Company Information -->
								<div class="col-12">
									<h6 class="text-primary border-bottom pb-2 mb-3">Company Information</h6>
								</div>
								<div class="col-md-6">
									<label class="form-label">Company Name</label>
									<input type="text" class="form-control" id="edit_company_name" required>
								</div>
								<div class="col-md-6">
									<label class="form-label">Service Type</label>
									<select class="form-select" id="edit_service_type" required>
										<option value="">Select Service Type</option>
										<option value="fulfillment">Fulfillment</option>
										<option value="last-mile">Last Mile</option>
									</select>
								</div>

								<!-- Volume Information -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Volume Information</h6>
								</div>
								<div class="col-md-6">
									<label class="form-label">Weekly Shipments</label>
									<input type="number" class="form-control" id="edit_weekly_shipments" required>
								</div>
								<div class="col-md-6">
									<label class="form-label">Fulfilment Outbound (Units)</label>
									<input type="number" class="form-control" id="edit_weekly_units_outbound" required>
								</div>
								<div class="col-md-6">
									<label class="form-label">Fulfilment Inbound (Units)</label>
									<input type="number" class="form-control" id="edit_weekly_units_inbound" required>
								</div>

								<!-- Frequency & Units -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Frequency & Units</h6>
								</div>
								<div class="col-md-6">
									<label class="form-label">Inbound Frequency</label>
									<select class="form-select" id="edit_inbound_frequency" required>
										<option value="">Select frequency</option>
										<option value="daily">Daily</option>
										<option value="weekly">Weekly</option>
										<option value="biweekly">Biweekly</option>
									</select>
								</div>
								<div class="col-md-6">
									<label class="form-label">Average Units per Shipment</label>
									<input type="number" class="form-control" id="edit_avg_units" required>
								</div>

								<!-- SKUs Section -->
								<div class="col-12 mt-4" id="edit_skus_container">
									<h6 class="text-primary border-bottom pb-2 mb-3">Special SKUs for Seasonality</h6>
									<div class="form-group">
										<label class="form-label">SKU Notes</label>
										<textarea class="form-control" id="edit_seasonality_skus_notes" rows="3" placeholder="Enter SKU details here"></textarea>
									</div>
								</div>

								<!-- Bundles Section -->
								<div class="col-12 mt-4" id="edit_bundles_container">
									<h6 class="text-primary border-bottom pb-2 mb-3">Special Bundles</h6>
									<div class="mt-3">
										<label class="form-label">Bundle Items</label>
										<div id="edit_bundles_list" class="mb-3">
											<!-- Bundle items will be added here dynamically -->
										</div>
										<div id="no_bundles_message" class="text-muted small mb-3">
											<i class="bi bi-info-circle me-1"></i>
											No bundles added yet. Click "Add Bundle" to create bundle items.
										</div>
										<button type="button" class="btn btn-sm btn-outline-primary" id="add_bundle_btn">
											<i class="bi bi-plus-circle me-1"></i>
											Add Bundle
										</button>
									</div>
								</div>

								<!-- Payment Information -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Payment Information</h6>
								</div>
								<div class="col-md-6">
									<label class="form-label">COD Percentage (%)</label>
									<input type="number" class="form-control" id="edit_cod_percent" min="0" max="100" step="0.01" required>
								</div>
								<div class="col-md-6">
									<label class="form-label">PPD Percentage (%)</label>
									<input type="number" class="form-control" id="edit_ppd_percent" min="0" max="100" step="0.01" required>
									<div class="form-text">COD + PPD must equal 100%</div>
								</div>

								<!-- Service Mix -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Service Mix</h6>
								</div>
								<div class="col-md-4">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" value="hb" id="edit_service_hb" name="edit_service_mix">
										<label class="form-check-label" for="edit_service_hb">Heavy & Bulky</label>
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" value="international" id="edit_service_int" name="edit_service_mix">
										<label class="form-check-label" for="edit_service_int">International</label>
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" value="parcel" id="edit_service_parcel" name="edit_service_mix">
										<label class="form-check-label" for="edit_service_parcel">Parcel</label>
									</div>
								</div>

								<!-- Forecast Period -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Forecast Period</h6>
								</div>
								<div class="col-md-6">
									<label class="form-label">Start Date</label>
									<input type="date" class="form-control" id="edit_forecast_start_date" required>
								</div>
								<div class="col-md-6">
									<label class="form-label">End Date</label>
									<input type="date" class="form-control" id="edit_forecast_end_date" required>
								</div>

								<!-- Notes -->
								<div class="col-12 mt-4">
									<h6 class="text-primary border-bottom pb-2 mb-3">Additional Information</h6>
								</div>
								<div class="col-12">
									<label class="form-label">Notes</label>
									<textarea class="form-control" id="edit_notes" rows="3" placeholder="Additional notes or comments"></textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="button" class="btn btn-primary" id="saveCustomerChanges">Save Changes</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
		<script src="assets/js/supabaseClient.js"></script>
		<script src="assets/js/navbar.js"></script>
		<script src="assets/js/dashboard.js"></script>
		<script>
			mountNavbar('dashboard');
		</script>
	</body>
</html>
