<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Admin Dashboard</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="assets/css/styles.css">
		<style>
			/* Resizable table columns */
			#submissionsTable {
				table-layout: fixed;
			}
			
			#submissionsTable th {
				position: relative;
				min-width: 80px;
				border-right: 2px solid #dee2e6;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				user-select: none;
			}
			
			/* Sticky header */
			#submissionsTable thead th {
				position: sticky;
				top: 0;
				background-color: #f8f9fa;
				z-index: 10;
				box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1);
			}
			
			/* Column resize handle */
			.resize-handle {
				position: absolute;
				right: -4px;
				top: 0;
				height: 100%;
				width: 8px;
				cursor: col-resize;
				background: rgba(0, 0, 0, 0.1);
				z-index: 11;
				border-radius: 2px;
			}
			
			.resize-handle:hover {
				background: rgba(0, 123, 255, 0.5);
				width: 10px;
				right: -5px;
			}
			
			/* Improved cell styling */
			#submissionsTable td {
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				padding: 8px 12px;
			}
			
			/* Specific column widths */
			#submissionsTable th:nth-child(1) { width: 120px; } /* Created */
			#submissionsTable th:nth-child(2) { width: 120px; } /* Company */
			#submissionsTable th:nth-child(3) { width: 100px; } /* Service Type */
			#submissionsTable th:nth-child(4) { width: 80px; } /* Daily Ship */
			#submissionsTable th:nth-child(5) { width: 80px; } /* Daily Out */
			#submissionsTable th:nth-child(6) { width: 80px; } /* Daily In */
			#submissionsTable th:nth-child(7) { width: 100px; } /* Inbound Freq */
			#submissionsTable th:nth-child(8) { width: 100px; } /* Avg Units/Ship */
			#submissionsTable th:nth-child(9) { width: 70px; } /* COD % */
			#submissionsTable th:nth-child(10) { width: 70px; } /* PPD % */
			#submissionsTable th:nth-child(11) { width: 70px; } /* Tier1 */
			#submissionsTable th:nth-child(12) { width: 70px; } /* Tier2 */
			#submissionsTable th:nth-child(13) { width: 70px; } /* Tier3 */
			#submissionsTable th:nth-child(14) { width: 70px; } /* H&B */
			#submissionsTable th:nth-child(15) { width: 70px; } /* Int */
			#submissionsTable th:nth-child(16) { width: 70px; } /* Parcel */
			#submissionsTable th:nth-child(17) { width: 180px; } /* Forecast Period */
			#submissionsTable th:nth-child(18) { width: 150px; } /* Notes */
			#submissionsTable th:nth-child(19) { width: 120px; } /* Actions */
			
			/* Scrollbar styling */
			.table-responsive::-webkit-scrollbar {
				height: 8px;
				width: 8px;
			}
			
			.table-responsive::-webkit-scrollbar-track {
				background: #f1f1f1;
				border-radius: 4px;
			}
			
			.table-responsive::-webkit-scrollbar-thumb {
				background: #888;
				border-radius: 4px;
			}
			
			.table-responsive::-webkit-scrollbar-thumb:hover {
				background: #555;
			}
		</style>
	</head>
	<body>
		<div id="navbar-container"></div>
		<main class="container py-3">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h1 class="h4 page-header" id="dashboardTitle">Global Forecast Dashboard</h1>
				<div class="d-flex gap-2">
					<select id="customerFilter" class="form-select" style="min-width:260px;"></select>
					<button class="btn btn-outline-primary" id="downloadPdfBtn">Download PDF</button>
				</div>
			</div>

			<div id="dashboard-container">
				<ul class="nav nav-tabs" id="dashTabs" role="tablist">
					<li class="nav-item" role="presentation">
						<button class="nav-link active" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts" type="button" role="tab">Charts</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">Data</button>
					</li>
				</ul>
				<div class="tab-content" id="dashTabsContent">
					<div class="tab-pane fade show active" id="charts" role="tabpanel">
						<div class="row g-3">
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Total Expected Monthly Shipments</h6><canvas id="chartShipments"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Total Expected Monthly Invoice Value</h6><canvas id="chartInvoice"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Average Service Mix</h6><canvas id="chartService"></canvas></div></div>
							</div>
							<div class="col-md-6">
								<div class="card"><div class="card-body"><h6>Average COD/PPD Split</h6><canvas id="chartCod"></canvas></div></div>
							</div>
						</div>
					</div>
					<div class="tab-pane fade" id="data" role="tabpanel">
						<div class="table-responsive" style="max-height: 70vh; overflow-x: auto; overflow-y: auto;">
							<table class="table table-sm align-middle table-striped" id="submissionsTable" style="min-width: 1400px;">
								<thead>
									<tr>
										<th>Created</th>
										<th>Company</th>
										<th>Service Type</th>
										<th>Daily Ship</th>
										<th>Daily Out</th>
										<th>Daily In</th>
										<th>Inbound Freq</th>
										<th>Avg Units/Ship</th>
										<th>COD %</th>
										<th>PPD %</th>
										<th>Tier1</th>
										<th>Tier2</th>
										<th>Tier3</th>
										<th>H&B</th>
										<th>Int</th>
										<th>Parcel</th>
										<th>Forecast Period</th>
										<th>Notes</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</main>

		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
		<script src="assets/js/supabaseClient.js"></script>
		<script src="assets/js/navbar.js"></script>
		<script src="assets/js/dashboard.js"></script>
		<script>
			mountNavbar('dashboard');
		</script>
	</body>
</html>
